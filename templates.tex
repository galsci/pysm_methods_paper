\section{Galactic Emission Templates} \label{sec:templates}
On large angular scales, Galactic emission is well constrained at some frequencies by current data, and the models developed here should accord with these constraints as closely as possible. In this section, we describe the data-driven templates used in the new models and comment on differences with previous PySM models.

\subsection{The multicomponent ISM emission}

The Galactic interstellar medium (ISM) consists of matter and radiation in various forms. At the microwave wavelengths relevant for CMB observation, hot cosmic ray electrons spiraling in the Galactic magnetic field emit synchrotron radiation, while warm ionised gas emits free-free (or \emph{Brehmstrahlung}) radiation through the interaction of free electrons with ionized atoms. Both of those dominate the ISM emission at frequencies below $\sim$10-100~GHz, depending on the region being considered.  
Cold ($\sim$10-30~K) grains of interstellar dust primarily emit thermal radiation with a spectrum that peaks at about 2~THz, and shows an excess above a typical blackbody curve below $\nu=100$~GHz, dubbed anomalous microwave emission (AME). AME, first detected as a component of microwave emission correlated to IRAS dust maps \citep{1996ApJ...464L...5K,1997ApJ...486L..23L} and further characterized using WMAP and Planck data \citep{planck2011-7.2}, is thought to be due to spinning dust grains. Finally, atoms and molecules in the Galactic ISM, through vibrational and rotational shifts in energy levels, emit radiation in the form of a rich spectrum of discrete transition lines, including a bright comb of emission at multiples of the CO J=1-0 $\nu \simeq 115$~GHz rotational line of carbon monoxide. Here we describe our approach to modeling each of these components. 

In each sky pixel $p$, synchrotron emission $A_s(\nu,p)$ as a function of frequency is well fit by a power law with a pixel-dependent spectral index $\beta_s(p)$:
\begin{equation}
    A_s(\nu,p) \propto \nu^{\beta_s}(p),
\end{equation}
where $\beta_s(p) \simeq -3$ when the emission is expressed in Rayleigh-Jeans temperature units, and $\beta_s(p) \simeq -1$ when the emission is expressed in brightness units. Thermal dust emission $A_d(\nu,p)$ scales with frequency as
\begin{equation}
    A_d(\nu,p) \propto \nu^{\beta_d}(p) \, B_\nu(T_d(p)),
    \label{eq:dust-emission-law}
\end{equation}
where $\beta_d(p) \simeq 1.6$ on average, ranging from about 1.0 to about 2.2, and $T_d(p)$ ranges from 10 to 30~K.

\subsection{Dust Amplitude}
The Planck~2015 component separation results in total intensity remain state of the art despite updates in polarization in the 2018 data release \citep{planck2016-l04}. Previous PySM models like \bsh{fill} employed the dust templates from the \texttt{Commander} component separation analysis \citep{planck2014-a11}. However, the model fitting employed in \citet{planck2014-a11} did not differentiate between Galactic dust emission and the Cosmic Infrared Background (CIB), and so the component separated dust maps retain CIB signal that should not be included in simulations of Galactic emission (see Section~\ref{sec:CIBcontamination} for detailed discussion).

To address this issue, we instead use dust templates for the {\tt d9} and {\tt d10} models from analyses that separated Galactic dust emission from the CIB using the Generalized Needlet Internal Linear Combination (GNILC) algorithm \citep{2011MNRAS.418..467R}. In total intensity we thus employ the Planck GNILC 2015 component separated map at $353$\,GHz \citep{planck2016-XLVIII}\footnote{\texttt{COM\_CompMap\_Dust-GNILC-F353\_2048\_R2.00.fits}}, 
%which has a uniform angular resolution of $28^\prime$ and pixellated with $N_{\rm side} =2048$. 
\mr{which we reprocess to have spatially uniform angular resolution. Although the original template has variable angular resolution, ranging from $21.8'$ up to $5'$ depending on the sky regions, it was synthetized from ten needlet (wavelet) maps of different, but spatially-uniform, resolution scales \citep[][Figure~A.2]{planck2016-l04}. By conserving only the first six needlet maps, which probe dust intensity from the largest scales down to $21.8'$, for the synthesis of the dust template in every pixel,  we thus obtain the Planck GNILC 2015 dust intensity template at $N_{\rm side} =2048$ with a spatially uniform $21.8'$ angular resolution. The dust intensity at smaller scales being not reliable enough in current Planck templates, it is left for stochastic realizations of the small-scale dust emission  [MR: \textit{Giuseppe, please confirm if this was the reason for requesting uniform resolution}].
In addition,} we subtract the CIB monopole of $0.13\, \text{MJy}\cdot\text{sr}^{-1}$ present in the map \citep[][Section~2.2]{planck2016-l04}.

For the dust $Q$ and $U$ maps we employ the dust maps\footnote{\texttt{COM\_CompMap\_IQU-thermaldust-gnilc-varres\_2048\_R3.00.fits}} produced by the GNILC component separation from the third Planck release \citep{planck2016-l04,planck2016-l11B}. These maps have a spatially varying resolution, ranging from $21.8^\prime$ in the Galactic plane to $80^\prime$ at high Galactic latitudes, and are pixellated at $N_{\rm side} = 2048$. 

% To avoid issues related to the multi-resolution nature of the $Q$ and $U$ maps, we employ the full resolution templates, including also the small angular scales, in the region around the Galactic Plane ($f_{sky}\sim 90 \%$). This region is sufficiently bright that even the small scales are measured with high signal-to-noise.

To produce dust emission templates at the monochromatic frequency of 353\,GHz, we divide each of the $I$, $Q$, and $U$ maps by a factor of 1.098 to correct for the Planck bandpass \citep[][Table~2]{planck2016-l11A}.
%Given that the intensity template has been estimated in a different way to the Q and U templates, we employ two different multipole scale cut-offs: $\ell=400$ and $100$, respectively. This further prevents the mixing of scales due to variable resolutions. 

%Moreover, the synthesis of small scales involves regions far from the Galactic plane, essentially outside in a region encoding 97\% of the sky. This is because, inside this area, the dust signal presents a very high SNR that small angular scales (e.g. $\sim20 $ arcmin ) are less affected by noise. We therefore decide to optimally exploit the state-of-art data on dust emission by employing the real small scales from observations nearby the Galactic plane. 


\subsection{Dust Spectral Parameters}
We employ the publicly available spectral parameter maps of $\beta_d$\footnote {\texttt{COM\_CompMap\_Dust-GNILC-Model-Spectral-Index\_2048\_R2.00.fits}} and $T_d$\footnote{\texttt{COM\_CompMap\_Dust-GNILC-Model-Temperature\_2048\_R2.00.fits}} derived from 2015 Planck GNILC release. These maps benefit of lower CIB residuals as the methodology employed all the Planck  high frequency channels from 100 to 857\,GHz to improve the characterization of dust intensity by means of different spectral and spatial dependence of Galactic and extra-galactic emission. However, the estimate of $\beta_d$ and $T_d$ is highly degenerate making the maps at small angular scales ($<21.8^\prime$) are contaminated by artifacts due to noise and calibration errors. The chosen cut-off multipole for $\beta_d$ and $T_d$ is the same as the one adopted for the intensity amplitude template, i.e. $\ell=400 $.  

\subsection{Synchrotron Amplitude}
% The state-of-art on  synchrotron templates is  worse than the dust ones. Although several improvements have been obtained at low frequencies, e.g. SPASS survey at 2.3 GHz, and several other surveys are expected to release soon synchrotron maps observing  both  Northern and Southern sky  (e.g. QUIJOTE CBASS),   to date a full sky map at high SNR is yet to  be produced.  

We  adopted as  intensity synchrotron template the   Haslam map  rescaled to 23 GHZ assuming a constant spectral index of -3.1. Vice versa,  Q and U templates are derived from the WMAP K-band. Both $I$ and $QU$ templates are further convolved to a  2 deg beam to further reduce the noise contamination especially in the polarization templates. Finally, we  adopt $\ell = 36$ as  cut-off multipole scale  for synchrotron.  

\subsection{Synchrotron Spectral Parameters}
To build the large scale template for the spatial variation of the synchrotron spectral index $\beta_s$, we employ the full-sky $\beta_s$ map obtained by combining the Haslam map in total intensity at 408\,MHz \citep{Remazeilles:2014} and WMAP K-band data \citep{mivilledeschenes:2008}. This $\beta_s$ map has an angular resolution of about $7^{\circ}$ and is the same employed by previous PySM synchrotron models \citep{Thorne:2017}. 

Taking advantage of the new information about synchrotron emission coming from Planck and S-PASS \citet{Krachmalnicoff:2018}, observations we modified this template in order to get as close as possible to the constraints on $\beta_s$ coming from data.
 
We further include a \emph{curvature}, $c_s$,  of the  $\beta_s$, as an extra spatially varying synchrotron parameter. The existing \texttt{s3} model  implements curvature as a single global parameter, $c_s = -0.052 $, consistent with the measurements from ARCADE \citep[$c_s=-0.052 \pm 0.005$][]{Kogut:2012}. We employed the Haslam map $I_{408}$ smoothed at 5 deg rescaled on an  appropriate range so that $c_s$ matches the \citet{Kogut:2012} measurements within the ARCADE region; the mean and standard deviation of $c_s$ template are respectively $-0.0517$ and $0.0054$. 

Finally, both the $\beta_s$ and the $c_s$ templates are low pass filtered with $\ell=36$ to minimize artifacts from noise and the large beamsize.
% Moreover,  we also add stochastic gaussian small scales to this large scale template, as described in Section~\ref{sec:beta_s}.

\subsection{CO Emission}

\subsection{AME and free-free}